{% extends "layout.html" %}
{% block content %}

<h2 class="page-title">Transactions Overview</h2>

<div class="stats-container">
    <div class="stat-card">
        <h3>Total Transactions</h3>
        <p>{{ transactions|length }}</p>
    </div>
</div>

<div class="table-card">
    <div class="table-header">
        <h3>All Transactions</h3>
        <button onclick="toggleForm()" class="primary-btn">+ Add Transaction</button>
    </div>

    <table class="styled-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Account</th>
                <th>Amount</th>
                <th>Type</th>
                <th>Location</th>
                <th>Time</th>
            </tr>
        </thead>
        <tbody>
            {% for txn in transactions %}
            <tr>
                <td>{{ txn.txn_id }}</td>
                <td>{{ txn.account_id }}</td>
                <td>â‚¹ {{ txn.amount }}</td>
                <td>{{ txn.transaction_type }}</td>
                <td>{{ txn.location }}</td>
                <td>{{ txn.timestamp }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Modal Form -->
<div id="transactionModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="toggleForm()">&times;</span>
        <h3>Add Transaction</h3>

        <form method="POST" action="/add_transaction" class="form-grid">

            <select name="account_id" required>
                {% for acc in accounts %}
                <option value="{{ acc.account_id }}">
                    ID {{ acc.account_id }} ({{ acc.account_type }})
                </option>
                {% endfor %}
            </select>

            <select name="device_id" required>
                {% for dev in devices %}
                <option value="{{ dev.device_id }}">
                    {{ dev.device_id }} ({{ dev.device_type }})
                </option>
                {% endfor %}
            </select>

            <input type="number" step="0.01" name="amount" placeholder="Amount" required>

            <select name="transaction_type" required>
                <option value="debit">Debit</option>
                <option value="credit">Credit</option>
            </select>

            <input type="text" name="location" placeholder="Location" required>
            <input type="text" name="ip_address" placeholder="IP Address" required>

            <button type="submit" class="primary-btn full-width">
                Submit Transaction
            </button>

        </form>
    </div>
</div>

<script>
function toggleForm() {
    const modal = document.getElementById("transactionModal");
    modal.style.display = modal.style.display === "flex" ? "none" : "flex";
}
</script>

{% endblock %}
